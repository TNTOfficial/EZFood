<div class="container mx-auto p-4 bg-white dark:bg-zinc-900 rounded-lg">
  <div class="mb-6 flex items-center">
    <button (click)="goBack()"
      class="mr-4 text-gray-500 hover:text-gray-700 dark:text-zinc-300 dark:hover:text-zinc-50">
      <i-lucide [img]="ArrowLeft" class="size-6"></i-lucide>
    </button>
    <h1 class="text-2xl font-semibold text-gray-800 dark:text-white">Onboarding Details</h1>
  </div>


  <div
    class="bg-white dark:bg-zinc-900 text-black dark:text-white rounded-lg shadow-lg shadow-zinc-100 dark:shadow-zinc-700 border-t border-zinc-200 dark:border-zinc-700 overflow-hidden">



    <!-- Loading State -->
    @if (loading()) {
    <div class="flex justify-center my-8">
      <app-loading-spinner></app-loading-spinner>
    </div>
    }

    <!-- Error State -->
    @if (error()) {
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      <p>{{ error() }}</p>
      <button (click)="loadDetails()" class="mt-2 bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded text-sm">
        Retry
      </button>
    </div>
    }

    <!-- User Profile -->
    @if (!loading() && !error() && truckDetail()) {


    <!-- Step 1 -->
    <div class="accoWrap step_1 border-b border-zinc-200 dark:border-zinc-700 transition-all duration-300">
      <button (click)="stepOpen(1)"
        [class]="step1 ? 'border-b border-l-6 border-l-zinc-700 dark:border-l-zinc-500':'border-b-0 border-l-6 border-l-transparent'"
        class="flex justify-between items-center gap-5 w-full p-5 font-bold border-zinc-200 dark:border-zinc-700 rounded-lg transition-all duration-300">
        <span>Step 1 :- Truck Details</span>
        <div class="arrowicon transition-all duration-300" [class]="step1 ? 'rotate-180':'rotae-0'">
          <i-lucide [img]="ChevronDown" class="size-5"></i-lucide>
        </div>
      </button>
      <div class="transition-all duration-300" [class]="step1  ? 'my-3 grid grid-rows-[1fr]':'grid grid-rows-[0fr]'">
        <div class="overflow-hidden">
          <ul class="gap-3 flex justify-start items-center flex-wrap px-5">
            <li
              class="flex-[1_1_12.5rem] py-2 px-4 rounded-md bg-white dark:bg-zinc-800 flex flex-col gap-3 items-stretch justify-center">
              <p class="text-sm font-bold text-gray-800 dark:text-zinc-100">Truck Name:</p>
              <p
                class="text-zinc-700 dark:text-zinc-300 p-3 rounded border border-zinc-200 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800">
                {{ truckDetail()!.data.stepOne.truckName }}</p>
            </li>
            <li
              class="flex-[1_1_12.5rem] py-2 px-4 rounded-md bg-white dark:bg-zinc-800 flex flex-col gap-3 items-stretch justify-center">
              <p class="text-sm font-bold text-gray-800 dark:text-zinc-100">Truck Owner Name:</p>
              <p
                class="text-zinc-700 dark:text-zinc-300 p-3 rounded border border-zinc-200 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800">
                {{ truckDetail()!.data.stepOne.truckOwnerName }}</p>
            </li>

            <li
              class="flex-[1_1_12.5rem] py-2 px-4 rounded-md bg-white dark:bg-zinc-800 flex flex-col gap-3 items-stretch justify-center">
              <p class="text-sm font-bold text-gray-800 dark:text-zinc-100">Phone Number:</p>
              <p
                class="text-zinc-700 dark:text-zinc-300 p-3 rounded border border-zinc-200 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800">
                {{ truckDetail()!.data.stepOne.phoneNumber }}</p>
            </li>

            <li
              class="flex-[1_1_12.5rem] py-2 px-4 rounded-md bg-white dark:bg-zinc-800 flex flex-col gap-3 items-stretch justify-center">
              <p class="text-sm font-bold text-gray-800 dark:text-zinc-100">Address:</p>
              <p
                class="text-zinc-700 dark:text-zinc-300 p-3 rounded border border-zinc-200 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800">
                {{ truckDetail()!.data.stepOne.address }}</p>
            </li>

            <li
              class="flex-[1_1_12.5rem] py-2 px-4 rounded-md bg-white dark:bg-zinc-800 flex flex-col gap-3 items-stretch justify-center">
              <p class="text-sm font-bold text-gray-800 dark:text-zinc-100">Truck Status:</p>
              <p
                class="text-zinc-700 dark:text-zinc-300 p-3 rounded border border-zinc-200 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800">
                {{ getStatus(truckDetail()!.data.step) }}</p>
            </li>
          </ul>
        </div>
      </div>

    </div>

    <!-- Step 2 -->
    <div class="accoWrap step_2 border-b border-zinc-200 dark:border-zinc-700 transition-all duration-300">
      <button (click)="stepOpen(2)"
        [class]="step2 ? 'border-b border-l-6 border-l-zinc-700 dark:border-l-zinc-500':'border-b-0 border-l-6 border-l-transparent'"
        class="flex justify-between items-center gap-5 w-full p-5 font-bold border-zinc-200 dark:border-zinc-700 rounded-lg transition-all duration-300">
        <span>Step 2 :- Cuisine Type</span>
        <div class="arrowicon transition-all duration-300" [class]="step2 ? 'rotate-180':'rotae-0'">
          <i-lucide [img]="ChevronDown" class="size-5"></i-lucide>
        </div>
      </button>
      <div class="transition-all duration-300" [class]="step2  ? 'my-3 grid grid-rows-[1fr]':'grid grid-rows-[0fr]'">
        <div class="overflow-hidden">
          <ul class="gap-3 flex justify-start items-center flex-wrap px-5">
            @for(item of truckDetail()!.data.stepTwo.cuisines; track item){
            <li
              class="flex-[1_1_12.5rem] py-2 px-3 rounded-full bg-white dark:bg-zinc-800 border-2 border-green-400 dark:border-green-700 flex gap-1 justify-center items-center max-w-fit">
              <i-lucide [img]="BadgeCheck" class="size-6 text-green-600 dark:text-green-700" strokeWidth="2"></i-lucide>
              <span class="text-sm font-bold text-gray-800 dark:text-zinc-100">{{item}}</span>
            </li> }
          </ul>
        </div>
      </div>

    </div>

    <!-- Step-3 -->
    <div class="accoWrap step_3 border-b border-zinc-200 dark:border-zinc-700 transition-all duration-300">
      <button (click)="stepOpen(3)"
        [class]="step3 ? 'border-b border-l-6 border-l-zinc-700 dark:border-l-zinc-500':'border-b-0 border-l-6 border-l-transparent'"
        class="flex justify-between items-center gap-5 w-full p-5 font-bold border-zinc-200 dark:border-zinc-700 rounded-lg transition-all duration-300">
        <span>Step 3 :- Business Details & Description</span>
        <div class="arrowicon transition-all duration-300" [class]="step3 ? 'rotate-180':'rotae-0'">
          <i-lucide [img]="ChevronDown" class="size-5"></i-lucide>
        </div>
      </button>
      <div class="transition-all duration-300" [class]="step3  ? 'my-3 grid grid-rows-[1fr]':'grid grid-rows-[0fr]'">
        <div class="overflow-hidden">
          <ul class="gap-3 flex justify-start items-stretch flex-wrap px-5">

            <li
              class="flex-[1_1_12.5rem] py-2 px-4 rounded-md bg-white dark:bg-zinc-800 flex flex-col gap-3 items-stretch justify-center">
              <p class="text-sm font-bold text-gray-800 dark:text-zinc-100">Bussiness Start Year:</p>
              <p
                class="text-zinc-700 dark:text-zinc-300 p-3 rounded border border-zinc-200 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800">
                {{ truckDetail()!.data.stepThree.bussinessStartYear }}</p>
            </li>

            <li
              class="flex-[1_1_12.5rem] py-2 px-4 rounded-md bg-white dark:bg-zinc-800 flex flex-col gap-3 items-stretch justify-center">
              <p class="text-sm font-bold text-gray-800 dark:text-zinc-100">EIN:</p>
              <p
                class="text-zinc-700 dark:text-zinc-300 p-3 rounded border border-zinc-200 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800">
                {{ truckDetail()!.data.stepThree.ein }}</p>
            </li>

            <li
              class="flex-[1_1_12.5rem] py-2 px-4 rounded-md bg-white dark:bg-zinc-800 flex gap-3 items-end justify-between">

              <div
                [class]="truckDetail()!.data.stepThree.isBreakfast == true ? ' border-green-400 dark:border-green-700': ' border-red-400 dark:border-red-400'"
                class="flex-[1_1_12.5rem] py-2 px-3 rounded-full bg-white dark:bg-zinc-800 border-2 flex gap-1 justify-center items-center max-w-fit max-h-fit">
                <i-lucide
                  [class]="truckDetail()!.data.stepThree.isBreakfast == true ? '  text-green-600 dark:text-green-700 ': '  text-red-500 dark:text-red-400 '"
                  [img]="truckDetail()!.data.stepThree.isBreakfast == true ? BadgeCheck : CircleX" class="size-6"
                  strokeWidth="2"></i-lucide>
                <span class="text-sm font-bold text-gray-800 dark:text-zinc-100"> BreakFast </span>
              </div>
              <div
                [class]="truckDetail()!.data.stepThree.isLunch == true ? ' border-green-400 dark:border-green-700': ' border-red-400 dark:border-red-400'"
                class="flex-[1_1_12.5rem] py-2 px-3 rounded-full bg-white dark:bg-zinc-800 border-2 flex gap-1 justify-center items-center max-w-fit max-h-fit">
                <i-lucide
                  [class]="truckDetail()!.data.stepThree.isLunch == true ? '  text-green-600 dark:text-green-700 ': '  text-red-500 dark:text-red-400 '"
                  [img]="truckDetail()!.data.stepThree.isLunch == true ? BadgeCheck : CircleX" class="size-6"
                  strokeWidth="2"></i-lucide>
                <span class="text-sm font-bold text-gray-800 dark:text-zinc-100"> Lunch</span>
              </div>
              <div
                [class]="truckDetail()!.data.stepThree.isDinner == true ? ' border-green-400 dark:border-green-700': ' border-red-400 dark:border-red-400'"
                class="flex-[1_1_12.5rem] py-2 px-3 rounded-full bg-white dark:bg-zinc-800 border-2 flex gap-1 justify-center items-center max-w-fit max-h-fit">
                <i-lucide
                  [class]="truckDetail()!.data.stepThree.isDinner == true ? '  text-green-600 dark:text-green-700 ': '  text-red-500 dark:text-red-400 '"
                  [img]="truckDetail()!.data.stepThree.isDinner == true ? BadgeCheck : CircleX" class="size-6"
                  strokeWidth="2"></i-lucide>
                <span class="text-sm font-bold text-gray-800 dark:text-zinc-100"> Dinner</span>
              </div>
            </li>

            <li
              class="flex-[1_1_12.5rem] py-2 px-4 rounded-md bg-white dark:bg-zinc-800 flex flex-col gap-3 items-stretch justify-center">
              <p class="text-sm font-bold text-gray-800 dark:text-zinc-100">Minimum Guarantee Amount:</p>
              <p
                class="text-zinc-700 dark:text-zinc-300 p-3 rounded border border-zinc-200 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800">
                {{ truckDetail()!.data.stepThree.minimumGuaranteeAmount }}
              </p>
            </li>

            <li
              class="flex-[1_1_12.5rem] min-w-full py-2 px-4 rounded-md bg-white dark:bg-zinc-800 flex flex-col gap-3 items-stretch justify-center">
              <p class="text-sm font-bold text-gray-800 dark:text-zinc-100">Business Description:</p>
              <p
                class="text-zinc-700 dark:text-zinc-300 p-3 rounded border border-zinc-200 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800">
                {{ truckDetail()!.data.stepThree.businessDescription }}</p>
            </li>
          </ul>

          <h3 class="mb-4 mt-10 text-lg text-zinc-700 dark:text-zinc-300 font-bold px-5">
            Uploaded Documents
          </h3>

          <ul class="flex flex-wrap gap-3 items-stretch justify-center divide-zinc-200 dark:divide-zinc-700 px-4 overflow-hidden">
            <li class="flex-1 border border-zinc-200 dark:border-zink-700 rounded-lg bg-zinc-50 dark:bg-zinc-800 px-4 py-2 flex gap-3 justify-between items-center">
              <div class="titel flex justify-strat items-center gap-1 text-sm font-bold ">
                <i-lucide [img]="Image" class="size-6 text-zinc-500 dark:text-zinc-300"></i-lucide>
                <span class="text-nowrap">COI</span>
              </div>
              @if(checkDocType(truckDetail()!.data.stepThree.coi) == "pdf"){
              <button (click)="openPdf(truckDetail()!.data.stepThree.coi)"
                class="text-sm font-medium bg-zinc-500 hover:bg-green-600 cursor-pointer dark:bg-zinc-700 text-nowrap px-3 py-3.5 rounded text-white flex justify-center items-center gap-1"><i-lucide
                  [img]="View" class="size-5"></i-lucide><span>View Document</span></button>

              } @else {
              <button (click)="viewDocument(truckDetail()!.data.stepThree.coi!)"
                class="text-sm font-medium bg-zinc-500 hover:bg-green-600 cursor-pointer dark:bg-zinc-700 text-nowrap px-3 py-3.5 rounded text-white flex justify-center items-center gap-1"><i-lucide
                  [img]="View" class="size-5"></i-lucide><span>View Document</span></button>
              }
            </li>
            <li class="flex-1 border border-zinc-200 dark:border-zink-700 rounded-lg bg-zinc-50 dark:bg-zinc-800 px-4 py-2 flex gap-3 justify-between items-center">
              <div class="titel flex justify-strat items-center gap-1 text-sm font-bold ">
                <i-lucide [img]="Image" class="size-6 text-zinc-500 dark:text-zinc-300"></i-lucide>
                <span class="text-nowrap">W9</span>
              </div>
              @if(checkDocType(truckDetail()!.data.stepThree.w9) == "pdf"){
              <button (click)="openPdf(truckDetail()!.data.stepThree.w9)"
                class="text-sm font-medium bg-zinc-500 hover:bg-green-600 cursor-pointer dark:bg-zinc-700 text-nowrap px-3 py-3.5 rounded text-white flex justify-center items-center gap-1"><i-lucide
                  [img]="View" class="size-5"></i-lucide><span>View Document</span></button>

              } @else {
              <button (click)="viewDocument(truckDetail()!.data.stepThree.w9!)"
                class="text-sm font-medium bg-zinc-500 hover:bg-green-600 cursor-pointer dark:bg-zinc-700 text-nowrap px-3 py-3.5 rounded text-white flex justify-center items-center gap-1"><i-lucide
                  [img]="View" class="size-5"></i-lucide><span>View Document</span></button>
              }
            </li>
            <li class="flex-1 border border-zinc-200 dark:border-zink-700 rounded-lg bg-zinc-50 dark:bg-zinc-800 px-4 py-2 flex gap-3 justify-between items-center">
              <div class="titel flex justify-strat items-center gap-1 text-sm font-bold ">
                <i-lucide [img]="Image" class="size-6 text-zinc-500 dark:text-zinc-300"></i-lucide>
                <span class="text-nowrap">Serve Safe Certificate</span>
              </div>
              @if(checkDocType(truckDetail()!.data.stepThree.serveSafeCertificate) == "pdf"){
              <button (click)="openPdf(truckDetail()!.data.stepThree.serveSafeCertificate)"
                class="text-sm font-medium bg-zinc-500 hover:bg-green-600 cursor-pointer dark:bg-zinc-700 text-nowrap px-3 py-3.5 rounded text-white flex justify-center items-center gap-1"><i-lucide
                  [img]="View" class="size-5"></i-lucide><span>View Document</span></button>

              } @else {
              <button (click)="viewDocument(truckDetail()!.data.stepThree.serveSafeCertificate!)"
                class="text-sm font-medium bg-zinc-500 hover:bg-green-600 cursor-pointer dark:bg-zinc-700 text-nowrap px-3 py-3.5 rounded text-white flex justify-center items-center gap-1"><i-lucide
                  [img]="View" class="size-5"></i-lucide><span>View Document</span></button>
              }
            </li>
            <li class="flex-1 border border-zinc-200 dark:border-zink-700 rounded-lg bg-zinc-50 dark:bg-zinc-800 px-4 py-2 flex gap-3 justify-between items-center">
              <div class="titel flex justify-strat items-center gap-1 text-sm font-bold ">
                <i-lucide [img]="Image" class="size-6 text-zinc-500 dark:text-zinc-300"></i-lucide>
                <span class="text-nowrap">DCH Certificate</span>
              </div>
              @if(checkDocType(truckDetail()!.data.stepThree.dchCertificate) == "pdf"){
              <button (click)="openPdf(truckDetail()!.data.stepThree.dchCertificate)"
                class="text-sm font-medium bg-zinc-500 hover:bg-green-600 cursor-pointer dark:bg-zinc-700 text-nowrap px-3 py-3.5 rounded text-white flex justify-center items-center gap-1"><i-lucide
                  [img]="View" class="size-5"></i-lucide><span>View Document</span></button>

              } @else {
              <button (click)="viewDocument(truckDetail()!.data.stepThree.dchCertificate!)"
                class="text-sm font-medium bg-zinc-500 hover:bg-green-600 cursor-pointer dark:bg-zinc-700 text-nowrap px-3 py-3.5 rounded text-white flex justify-center items-center gap-1"><i-lucide
                  [img]="View" class="size-5"></i-lucide><span>View Document</span></button>
              }
            </li>
          </ul>


        </div>
      </div>
    </div>

    <!-- Step-4 -->
    <div class="accoWrap step_4 border-b border-zinc-200 dark:border-zinc-700 transition-all duration-300">
      <button (click)="stepOpen(4)"
        [class]="step4 ? 'border-b border-l-6 border-l-zinc-700 dark:border-l-zinc-500':'border-b-0 border-l-6 border-l-transparent'"
        class="flex justify-between items-center gap-5 w-full p-5 font-bold border-zinc-200 dark:border-zinc-700 rounded-lg transition-all duration-300">
        <span>Step 4 :- Truck Photos</span>
        <div class="arrowicon transition-all duration-300" [class]="step4 ? 'rotate-180':'rotae-0'">
          <i-lucide [img]="ChevronDown" class="size-5"></i-lucide>
        </div>
      </button>
      <div class="transition-all duration-300" [class]="step4  ? 'my-3 grid grid-rows-[1fr]':'grid grid-rows-[0fr]'">
        <div class="overflow-hidden">
          <div class="flex flex-wrap justify-start items-stretch gap-5 mt-4 px-5">
            @for(item of truckDetail()!.data.stepFour.files; track item){
            <div
              class="flex-[1_1_18.75rem] border border-zinc-200 dark:border-zinc-700 rounded-lg overflow-hidden max-w-[18.75rem]">
              <img [src]="imageService.getImageUrl(item)" [alt]="item"
                class="h-full w-full object-cover max-h-[100px] rounded-lg" />
            </div>
            }
          </div>
        </div>
      </div>

    </div>
    <!-- Step-5 -->
    <div class="accoWrap step_5 border-b border-zinc-200 dark:border-zinc-700 transition-all duration-300">
      <button (click)="stepOpen(5)"
        [class]="step5 ? 'border-b border-l-6 border-l-zinc-700 dark:border-l-zinc-500':'border-b-0 border-l-6 border-l-transparent'"
        class="flex justify-between items-center gap-5 w-full p-5 font-bold border-zinc-200 dark:border-zinc-700 rounded-lg transition-all duration-300">
        <span>Step 5 :- Truck Menus</span>
        <div class="arrowicon transition-all duration-300" [class]="step5 ? 'rotate-180':'rotae-0'">
          <i-lucide [img]="ChevronDown" class="size-5"></i-lucide>
        </div>
      </button>
      <div class="transition-all duration-300" [class]="step5  ? 'my-3 grid grid-rows-[1fr]':'grid grid-rows-[0fr]'">
        <div class="overflow-hidden">
          <div class="flex flex-wrap justify-start items-stretch gap-5 mt-4 px-5">
            @for(item of truckDetail()!.data.stepFive.files; track item){
            <div
              class="flex-[1_1_18.75rem] border border-zinc-200 dark:border-zinc-700 rounded-lg overflow-hidden max-w-[18.75rem]">
              <img [src]="imageService.getImageUrl(item)" [alt]="item"
                class="h-full w-full object-cover max-h-[100px] rounded-lg" />
            </div>
            }
          </div>
        </div>
      </div>

  </div>
  }
</div>

<!-- Modal Document Viewer -->

<div [class]="isModalOpen ? 'opacity-100 z-[990] delay-0':'opacity-0 -z-10 delay-600'"
  class="modal fixed inset-0 bg-black/50 transition-all duration-300 flex justify-center items-center opacity-0 -z-10 ">
  <div [class]="isModalOpen ? 'scale-y-100 delay-300':'scale-y-0 delay-300'"
    class="max-w-xl w-full bg-white dark:bg-zinc-800 p-2 rounded-lg relative z-0 transition-transform duration-300 h-fit scale-y-0">
    <div (click)="closeDocument()"
      class="closeButton size-10 shadow rounded-full bg-white dark:bg-zinc-600 text-red-700 absolute top-4 right-4 z-10 flex justify-center items-center cursor-pointer">
      <i-lucide [img]="X"></i-lucide>
    </div>

    <img [class]="isModalOpen ? 'scale-x-100 delay-600':'scale-x-0 delay-0'" [src]="imageService.getImageUrl(imageSRC)"
      alt="Document" class="h-full w-full object-contain inline-block transition-transform duration-300 scale-x-0 ">

  </div>
</div>
<app-pdf-viewer [dataUrl]="pdfData" [isVisible]="(pdfViewerService.isModalVisible$ | async)" (closeModal)="pdfViewerService.hideModal()">
</app-pdf-viewer>
